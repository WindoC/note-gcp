<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ title or "Markdown Notes" }}{% endblock %}</title>
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1><a href="/notes" onclick="return confirmNavigationIfEditor(event, '/notes')">üìù Markdown Notes</a></h1>
            </div>
            <div class="nav-links">
                <!-- <a href="/notes">List Notes</a> -->
                <a href="/notes/new" class="btn" onclick="return confirmNavigationIfEditor(event, '/notes/new')">Create</a>
                <form method="post" action="/logout" style="display: inline;" onsubmit="return confirmLogoutIfEditor(event)">
                    <button type="submit" class="btn btn-danger">Logout</button>
                </form>
            </div>
        </div>
    </nav>
    
    <main class="container">
        {% if message %}
        <div class="message">
            {{ message }}
        </div>
        {% endif %}
        
        {% block content %}
        <div class="welcome">
            <h2>Welcome to your personal markdown notes!</h2>
            <p>This is a secure, single-user application for managing your markdown notes.</p>
        </div>
        {% endblock %}
    </main>
    
    <script src="/static/js/editor.js"></script>
    <script>
    // Global navigation protection functions
    function confirmNavigationIfEditor(event, targetUrl) {
        // Only show warning if we're on an editor page and have unsaved changes
        if (typeof window.hasUnsavedChanges === 'function' && window.hasUnsavedChanges()) {
            event.preventDefault();
            if (confirm('You have unsaved changes. Are you sure you want to leave without saving?')) {
                window.location.href = targetUrl;
            }
            return false;
        }
        return true;
    }
    
    function confirmLogoutIfEditor(event) {
        // Only show warning if we're on an editor page and have unsaved changes
        if (typeof window.hasUnsavedChanges === 'function' && window.hasUnsavedChanges()) {
            event.preventDefault();
            if (confirm('You have unsaved changes. Are you sure you want to logout without saving?')) {
                event.target.submit();
            }
            return false;
        }
        return true;
    }
    </script>
</body>
</html>